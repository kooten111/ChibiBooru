/* Override header animation for image page */
.image-page .header {
    animation: none !important;
}

.image-page .header-container {
    transition: transform var(--transition-smooth) ease-in-out;
}

/* Prevent body scrolling on image page */
body.image-page {
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
}

/* Grid Container - fills remaining viewport */
.image-page .container {
    display: grid;
    grid-template-columns: 320px 1fr 320px;
    grid-template-rows: 1fr;
    max-width: none;
    margin: 0;
    padding: 20px 20px 0 20px;
    gap: 20px;
    flex: 1;
    min-height: 0;
    overflow: hidden;
}

/* Grid positioning */
.image-page .sidebar-left {
    grid-column: 1;
    grid-row: 1;
}

.image-page .main-content {
    grid-column: 2;
    grid-row: 1;
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
}

.image-page .image-and-actions-container {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 0;
    position: relative;
}

.image-page .sidebar-right {
    grid-column: 3;
    grid-row: 1;
}

/* Sidebars - Flex containers that fill height */
.image-page .sidebar-left,
.image-page .sidebar-right {
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow-y: hidden;
    overflow-x: hidden;
    gap: 8px;
    position: relative;
    /* Remove container styling so panels are distinct */
    background: transparent;
    padding: 0;
}

/* ═══ UNIFIED SIDEBAR PANEL ═══ */

/* Sidebar gap - minimal since it's one unified panel now */
.image-page #sidebarLeft.sidebar-left {
    gap: 0;
}

/* Hide scrollbars on right sidebar while keeping scroll functionality */
.image-page .sidebar-right .related-grid-vertical,
.image-page .sidebar-right .panel-collapsible-content {
    scrollbar-width: none;
    -ms-overflow-style: none;
}
.image-page .sidebar-right .related-grid-vertical::-webkit-scrollbar,
.image-page .sidebar-right .panel-collapsible-content::-webkit-scrollbar {
    display: none;
}

/* The single unified sidebar panel */
.image-page .sidebar-panel {
    flex: 1 1 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
    background: var(--bg-secondary, rgba(20, 20, 30, 0.95));
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

/* Section headers inside unified panel — always visible (overrides mobile-toggle hiding) */
.image-page .sidebar-panel .sec-hdr {
    display: flex !important;
    align-items: center;
    gap: 6px;
    padding: 10px 14px;
    width: 100%;
    text-align: left;
    cursor: pointer;
    user-select: none;
    color: var(--text-secondary);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    background: none;
    border: none;
    border-bottom: 1px solid var(--border-color);
    font-family: inherit;
    transition: background 0.12s, color 0.12s;
    flex-shrink: 0;
}
.image-page .sidebar-panel .sec-hdr:hover {
    background: rgba(40, 40, 55, 0.6);
    color: var(--text-primary);
}
.image-page .sidebar-panel .sec-hdr.static {
    cursor: default;
}
.image-page .sidebar-panel .sec-hdr .arrow {
    margin-left: auto;
    font-style: normal;
    font-size: 9px;
    transition: transform 0.2s;
}
.image-page .sidebar-panel .sec-hdr.collapsed .arrow {
    transform: rotate(-90deg);
}

/* Section body - collapsible content */
.image-page .sidebar-panel .sec-body {
    padding: 12px 14px;
    overflow: hidden;
    transition: max-height 0.25s ease, opacity 0.2s ease, padding 0.2s ease;
    max-height: 1200px;
    opacity: 1;
}
.image-page .sidebar-panel .sec-body.collapsed {
    max-height: 0;
    opacity: 0;
    padding-top: 0;
    padding-bottom: 0;
}

/* Section dividers */
.image-page .sidebar-panel .sidebar-section {
    flex-shrink: 0;
    border-bottom: 1px solid var(--border-color);
}
.image-page .sidebar-panel .sidebar-section:last-child {
    border-bottom: none;
}

/* Tags section fills remaining space */
.image-page .sidebar-panel .sidebar-section.tags-section {
    flex: 1 1 0;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* When tags header is collapsed, shrink the tags section */
.image-page .sidebar-panel .sidebar-section.tags-section:has(.tags-scroll.collapsed) {
    flex: 0 0 auto;
}

/* Tags scroll area collapse */
.image-page .tags-scroll.collapsed {
    flex: 0 0 0;
    overflow: hidden;
    padding: 0;
    opacity: 0;
    transition: flex 0.25s ease, opacity 0.2s ease, padding 0.2s ease;
}

/* Tags scroll area */
.image-page .tags-scroll {
    flex: 1;
    overflow-y: auto;
    padding: 10px 14px;
    scrollbar-width: thin;
    scrollbar-color: rgba(40, 40, 55, 0.6) transparent;
}
.image-page .tags-scroll::-webkit-scrollbar {
    width: 3px;
}
.image-page .tags-scroll::-webkit-scrollbar-thumb {
    background: rgba(40, 40, 55, 0.6);
    border-radius: 2px;
}

/* ═══ FLOATING IMAGE TOOLBAR ═══ */
/* Video-player-style bottom overlay bar on the image area */
.image-page .image-toolbar {
    position: absolute;
    bottom: 16px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 6px 10px;
    background: rgba(15, 15, 25, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid var(--border-color);
    border-radius: 24px;
    z-index: calc(var(--z-dropdown) + 1);
    opacity: 0;
    transition: opacity 0.25s ease, transform 0.25s ease;
    transform: translateX(-50%) translateY(6px);
    pointer-events: none;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

/* Show toolbar when cursor approaches the bottom of the image area */
.image-page .image-view-wrapper.toolbar-near .image-toolbar,
.image-page .image-toolbar:hover,
.image-page .image-toolbar:focus-within {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

.image-page .image-view-wrapper.image-view-wrapper--toolbar-lock .image-toolbar {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
}

/* Toolbar button */
.image-page .toolbar-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 1px solid transparent;
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.15s ease;
    text-decoration: none;
    font-size: 1rem;
    padding: 0;
    font-family: inherit;
}
.image-page .toolbar-btn:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: var(--border-color-hover);
    color: var(--primary-blue);
    transform: scale(1.1);
}
.image-page .toolbar-btn.primary {
    color: var(--primary-blue);
}
.image-page .toolbar-btn.primary:hover {
    background: rgba(135, 206, 235, 0.15);
    border-color: var(--primary-blue);
}
.image-page .toolbar-btn.danger:hover {
    background: rgba(255, 107, 107, 0.15);
    border-color: var(--danger);
    color: var(--danger);
}
.image-page .toolbar-btn.favourite:hover {
    background: var(--favourite-pink-bg);
    border-color: var(--favourite-pink);
    color: var(--favourite-pink);
}
.image-page .toolbar-btn.favourite.active {
    color: var(--favourite-pink);
    background: var(--favourite-pink-bg);
    border-color: var(--favourite-pink);
}
.image-page .toolbar-icon {
    font-size: 16px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}
.image-page .toolbar-btn .favourite-icon {
    font-size: 16px;
    transition: transform 0.15s;
}

.image-page .image-toolbar.image-toolbar--editing {
    max-width: min(calc(100% - 20px), 900px);
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.image-page .image-toolbar.image-toolbar--editing::-webkit-scrollbar {
    display: none;
}

.image-page .image-toolbar.image-toolbar--editing .toolbar-btn--text {
    width: auto;
    min-width: 0;
    flex-shrink: 0;
    border-radius: 18px;
    padding: 0 12px;
    gap: 6px;
}

.image-page .image-toolbar.image-toolbar--editing .toolbar-btn--text:hover {
    transform: none;
}

.image-page .toolbar-btn__icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.image-page .toolbar-btn__label {
    font-size: 12px;
    line-height: 1;
    white-space: nowrap;
}

.image-page .toolbar-divider {
    width: 1px;
    height: 20px;
    background: var(--border-color);
    margin: 0 2px;
    flex-shrink: 0;
}

@media (max-width: 1200px) {
    .image-page .image-toolbar.image-toolbar--editing {
        gap: 2px;
        padding: 6px 8px;
    }

    .image-page .image-toolbar.image-toolbar--editing .toolbar-btn--text {
        padding: 0 10px;
    }
}

/* Hide toolbar in focus/fullscreen mode */
body:is(.ui-hidden, .focus-mode) .image-toolbar {
    display: none;
}

/* ═══ Meta Rows (Information Section) ═══ */
.image-page .meta-row {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    padding: 7px 0;
    border-bottom: 1px solid var(--border-color);
    gap: 10px;
}
.image-page .meta-row:last-child {
    border-bottom: none;
}
.image-page .meta-label {
    color: var(--text-muted);
    font-size: 11px;
    flex-shrink: 0;
}
.image-page .meta-value {
    color: var(--text-primary);
    font-size: 12px;
    text-align: right;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
}
.image-page .meta-value a {
    color: var(--primary-blue);
    text-decoration: none;
}
.image-page .meta-value a:hover {
    text-decoration: underline;
}
.image-page .meta-value .mono {
    font-family: monospace;
    font-size: 10px;
    word-break: break-all;
}
.image-page .rating-badge {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    padding: 1px 6px;
    border-radius: 20px;
    font-size: 10px;
    font-weight: 600;
}
.image-page .rating-badge.rating-general {
    background: var(--rating-general-bg);
    color: var(--rating-general);
    border: 1px solid rgba(34, 197, 94, 0.3);
}
.image-page .rating-badge.rating-sensitive {
    background: var(--rating-sensitive-bg);
    color: var(--rating-sensitive);
    border: 1px solid rgba(234, 179, 8, 0.3);
}
.image-page .rating-badge.rating-questionable {
    background: var(--rating-questionable-bg);
    color: var(--rating-questionable);
    border: 1px solid rgba(249, 115, 22, 0.3);
}
.image-page .rating-badge.rating-explicit {
    background: var(--rating-explicit-bg);
    color: var(--rating-explicit);
    border: 1px solid rgba(239, 68, 68, 0.3);
}
.image-page .score-bar {
    height: 3px;
    background: rgba(20, 20, 30, 0.6);
    border-radius: 2px;
    margin-top: 3px;
}
.image-page .score-fill {
    height: 100%;
    background: var(--primary-blue);
    border-radius: 2px;
}
/* Source links inside meta rows */
.image-page .meta-value .source-links-inline {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: flex-end;
}
.image-page .meta-value .source-links-inline a {
    font-size: 10px;
}

/* ═══ MINIMAL TEXT TAGS ═══ */

/* Tag category wrapper */
.image-page .tag-category {
    margin-bottom: 14px;
}

/* Category header - small uppercase label */
.image-page .tag-cat-name {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.07em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 6px;
    padding-bottom: 4px;
    border-bottom: 1px solid rgba(135, 206, 235, 0.08);
}

/* Tag chips container */
.image-page .tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0;
}

/* Individual tag - minimal text style with colored dot */
.image-page .tag-chip {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    height: auto;
    padding: 3px 6px;
    border-radius: var(--radius-xs);
    font-size: 12px;
    cursor: pointer;
    border: none;
    background: none;
    transition: background 0.12s, opacity 0.12s;
    white-space: nowrap;
    text-decoration: none;
    line-height: 1.5;
    /* Default color, overridden by category */
    color: var(--tag-general);
}
.image-page .tag-chip:hover {
    background: rgba(255, 255, 255, 0.06);
    opacity: 1;
}
.image-page .tag-chip .cnt {
    color: var(--text-disabled);
    font-size: 10px;
    opacity: 0.7;
}
.image-page .tag-chip::before {
    content: '';
    display: inline-block;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    flex-shrink: 0;
    background: currentColor;
    opacity: 0.6;
}

/* Base category colors - text only */
.image-page .tag-chip.character { color: var(--tag-character); }
.image-page .tag-chip.copyright { color: var(--tag-copyright); }
.image-page .tag-chip.artist { color: var(--tag-artist); }
.image-page .tag-chip.species { color: var(--tag-species); }
.image-page .tag-chip.general { color: var(--tag-general); }
.image-page .tag-chip.meta { color: var(--tag-meta); }

/* Extended sub-category colors - text only, consolidated via custom property */
.image-page .tag-chip.ext-subject { color: var(--tag-ext-subject); }
.image-page .tag-chip.ext-physique { color: var(--tag-ext-physique); }
.image-page .tag-chip.ext-hair { color: var(--tag-ext-hair); }
.image-page .tag-chip.ext-face { color: var(--tag-ext-face); }
.image-page .tag-chip.ext-genitalia { color: var(--tag-ext-genitalia); }
.image-page .tag-chip.ext-attire-main { color: var(--tag-ext-attire-main); }
.image-page .tag-chip.ext-attire-inner { color: var(--tag-ext-attire-inner); }
.image-page .tag-chip.ext-attire-legwear { color: var(--tag-ext-attire-legwear); }
.image-page .tag-chip.ext-attire-acc { color: var(--tag-ext-attire-acc); }
.image-page .tag-chip.ext-action { color: var(--tag-ext-action); }
.image-page .tag-chip.ext-pose { color: var(--tag-ext-pose); }
.image-page .tag-chip.ext-expression { color: var(--tag-ext-expression); }
.image-page .tag-chip.ext-sexual { color: var(--tag-ext-sexual); }
.image-page .tag-chip.ext-object { color: var(--tag-ext-object); }
.image-page .tag-chip.ext-setting { color: var(--tag-ext-setting); }
.image-page .tag-chip.ext-status { color: var(--tag-ext-status); }
.image-page .tag-chip.ext-framing { color: var(--tag-ext-framing); }
.image-page .tag-chip.ext-focus { color: var(--tag-ext-focus); }
.image-page .tag-chip.ext-style-art { color: var(--tag-ext-style-art); }
.image-page .tag-chip.ext-style-tech { color: var(--tag-ext-style-tech); }
.image-page .tag-chip.ext-meta-attr { color: var(--tag-ext-meta-attr); }
.image-page .tag-chip.ext-meta-text { color: var(--tag-ext-meta-text); }
.image-page .tag-chip.ext-uncategorized { color: var(--tag-uncategorized); }

/* Implied tags - subtle yellow tint without !important */
.image-page .tag-list .tag-chip.implied {
    color: #f59f00;
    background: rgba(255, 193, 7, 0.08);
    border-radius: var(--radius-xs);
}
.image-page .tag-list .tag-chip.implied::before {
    background: #f59f00;
}
.image-page .tag-list .tag-chip.implied .cnt {
    color: rgba(245, 159, 0, 0.5);
}
.image-page .tag-list .tag-chip.implied:hover {
    background: rgba(255, 193, 7, 0.14);
    opacity: 1;
}

/* Delta tag chips */
.image-page .tag-list .tag-chip.delta-added {
    color: var(--primary-blue-dark);
    background: rgba(74, 158, 255, 0.08);
}
.image-page .tag-list .tag-chip.delta-added::before {
    background: var(--primary-blue-dark);
}
.image-page .tag-list .tag-chip.delta-removed {
    color: var(--danger);
    background: rgba(255, 107, 107, 0.06);
    text-decoration: line-through;
    opacity: 0.6;
}
.image-page .tag-list .tag-chip.delta-removed::before {
    background: var(--danger);
}

/* Tag category subtitle (for Manual modifications) */
.image-page .tag-category-subtitle {
    font-weight: var(--font-weight-medium);
    font-size: 9px;
    color: var(--warning);
    margin-bottom: 4px;
    margin-top: 8px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    padding-top: 8px;
    border-top: 1px solid rgba(255, 165, 0, 0.2);
}

/* Pools section */
.image-page .sidebar-panel .pools-body {
    font-size: 11px;
    color: var(--text-secondary);
}
.image-page .sidebar-panel .pools-body .pool-entry {
    padding: 4px 0;
    border-bottom: 1px solid var(--border-color);
}
.image-page .sidebar-panel .pools-body .pool-entry:last-child {
    border-bottom: none;
}

/* ═══ Legacy support - keep .panel styles for right sidebar ═══ */

/* Panel Design for right sidebar — matched to .sidebar-panel */
.image-page .sidebar-right .panel {
    background: var(--bg-secondary, rgba(20, 20, 30, 0.95));
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
    padding: 0;
    box-shadow: none;
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    transition: none;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
}
.image-page .sidebar-right .panel:hover {
    border-color: var(--border-color);
}

/* Panel Header for right sidebar — matched to .sec-hdr */
.image-page .sidebar-right .panel>.panel-header {
    padding: 10px 14px;
    background: none;
    border-bottom: 1px solid var(--border-color);
    margin: 0;
    flex-shrink: 0;
    color: var(--text-secondary);
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.06em;
}
.image-page .sidebar-right .panel>.panel-header:hover {
    background: rgba(40, 40, 55, 0.6);
    color: var(--text-primary);
}

/* Panel Collapsible Content for right sidebar — matched to .sec-body / .tags-scroll */
.image-page .sidebar-right .panel>.panel-collapsible-content {
    padding: 10px 14px;
    overflow-y: auto;
    overflow-x: hidden;
    flex: 1 1 0;
    min-height: 0;
}

/* Pools section styling */
.image-page .sidebar-panel .sidebar-section.pools-section .pools-list-container {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* Image Display Area - legacy, no longer used */

/* Metadata Panel — legacy styles, kept for potential usage */

/* Related Images Vertical Panel - fill available height, clip so collapsible content scrolls */
.image-page .related-images-vertical {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
    transition: flex 0.3s ease-in-out;
}

/* When related-images panel is collapsed, remove flex space */
.image-page .related-images-vertical:has(.panel-header.collapsed) {
    flex: 0 0 auto;
}

.image-page .related-images-vertical h3 {
    margin: 0 0 15px 0;
    font-size: var(--font-size-lg);
    color: var(--primary-blue);
    font-weight: var(--font-weight-bold);
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.image-page .related-grid-vertical {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.image-page .related-thumb {
    position: relative;
    display: block;
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--border-color);
    transition: border-color var(--transition-smooth), box-shadow var(--transition-smooth), transform var(--transition-smooth);
    background: rgba(20, 20, 30, 0.5);
}

.image-page .related-thumb:hover {
    border-color: var(--border-color-hover);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    transform: translateY(-1px);
    z-index: calc(var(--z-base) + 1);
}

.image-page .related-thumb img {
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
    transition: transform var(--transition-smooth);
    transform: translateZ(0);
    backface-visibility: hidden;
}

.image-page .related-thumb:hover img {
    transform: scale(1.02) translateZ(0);
}

.image-page .related-thumb .label {
    position: absolute;
    top: 6px;
    left: 6px;
    padding: 2px 8px;
    border-radius: var(--radius-xl);
    font-size: 9px;
    font-weight: var(--font-weight-bold);
    text-transform: capitalize;
    letter-spacing: 0.4px;
    backdrop-filter: var(--blur-sm);
    box-shadow: var(--shadow-sm);
    color: #fff;
    transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-font-smoothing: antialiased;
    pointer-events: none;
}

.image-page .related-thumb .label.parent {
    background: linear-gradient(135deg, rgba(144, 238, 144, 0.95) 0%, rgba(102, 217, 160, 0.95) 100%);
}

.image-page .related-thumb .label.child {
    background: linear-gradient(135deg, rgba(221, 160, 221, 0.95) 0%, rgba(186, 127, 186, 0.95) 100%);
}

.image-page .related-thumb .label.similar,
.image-page .related-thumb .label.character,
.image-page .related-thumb .label.copyright,
.image-page .related-thumb .label.artist {
    background: var(--gradient-primary);
}

/* Similarity source indicators */
.image-page .related-thumb .label.similar-tag {
    background: linear-gradient(135deg, rgba(34, 197, 94, 0.95) 0%, rgba(22, 163, 74, 0.95) 100%);
}

.image-page .related-thumb .label.similar-semantic {
    background: linear-gradient(135deg, rgba(239, 68, 108, 0.95) 0%, rgba(200, 40, 80, 0.95) 100%);
}

.image-page .related-thumb .label.similar-visual {
    background: linear-gradient(135deg, rgba(251, 146, 60, 0.95) 0%, rgba(234, 88, 12, 0.95) 100%);
}

/* Tag Editor positioning within main content */
.image-page .tag-editor {
    width: fit-content;
    max-width: calc(100% - 40px);
    flex: 0 0 auto;
    margin: 0 var(--spacing-lg) var(--spacing-lg) var(--spacing-lg);
    overflow-y: auto;
    max-height: 50vh;
    align-self: center;
}

/* Image View - single source of truth for main image area
   Wrapper uses align-items: stretch so this has a definite height; image is always contained. */
.image-page .image-view {
    flex: 1 1 auto;
    min-height: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    padding: var(--spacing-lg);
    padding-bottom: calc(var(--spacing-lg) + 24px);
    position: relative;
}

/* Main image / video: always fully visible, never cropped (any aspect ratio or size) */
.image-page .image-view>img,
.image-page .image-view>video {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    display: block;
}

/* Stack fills the image view so original and upscaled use the same frame = same size when comparing */
.image-page .image-view .image-stack {
    position: relative;
    align-self: stretch;
    width: 100%;
    height: 100%;
    max-width: 100%;
    max-height: 100%;
}

/* During comparison: both images overlay in the same box for aligned C-key compare */
.image-page .image-view .image-stack.comparing img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
}

/* Normal viewing: use flex instead of grid so max-height resolves properly */
.image-page .image-view .image-stack:not(.comparing) {
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

.image-page .image-view .image-stack:not(.comparing) img {
    max-width: 100%;
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    min-height: 0;
}

/* Focus mode: ensure stack images use viewport units (higher specificity than :not(.comparing) rule) */
body:is(.ui-hidden, .focus-mode) .image-page .image-view .image-stack:not(.comparing) img {
    max-height: 100vh;
    max-width: 100vw;
}

.image-page .image-view>img,
.image-page .image-view>video {
    border-radius: var(--radius-xl);
    cursor: zoom-in;
    user-select: none;
    -webkit-user-drag: none;
    filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.35));
}

.image-page .image-view .image-stack img.original,
.image-page .image-view .image-stack img.upscaled {
    border-radius: var(--radius-xl);
    cursor: zoom-in;
    user-select: none;
    -webkit-user-drag: none;
    filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.35));
}

/* Optimize for zoom/pan performance - disable expensive properties during transform */
body.focus-mode .image-page .image-view>img,
body.focus-mode .image-page .image-view>video,
body.focus-mode .image-page .image-view .image-stack,
body.focus-mode .image-page .image-view .image-stack img {
    transition: none !important;
    animation: none !important;
    filter: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    -webkit-box-shadow: none !important;
}

.image-page .image-view video {
    cursor: default;
}

/* Fullscreen / UI Hidden mode */
body:is(.ui-hidden, .focus-mode) {
    overflow: hidden;
}

body:is(.ui-hidden, .focus-mode) .header-container {
    transform: translateY(-100%);
    transition: transform var(--transition-smooth);
}

body:is(.ui-hidden, .focus-mode) .sidebar-left,
body:is(.ui-hidden, .focus-mode) .sidebar-right,
body:is(.ui-hidden, .focus-mode) .actions-bar,
body:is(.ui-hidden, .focus-mode) .image-nav-btn {
    opacity: 0;
    pointer-events: none;
    transition: opacity var(--transition-smooth);
}

body:is(.ui-hidden, .focus-mode) .image-view {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: var(--blur-sm);
    z-index: calc(var(--z-modal) + 1);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-sizing: border-box;
    overflow: hidden;
}

body:is(.ui-hidden, .focus-mode) .image-view img {
    cursor: grab;
    max-height: 100vh;
    max-width: 100vw;
    filter: drop-shadow(0 0 60px rgba(0, 0, 0, 0.8));
    border-radius: 0;
    transform-origin: center center;
    /* will-change managed by JS on transform target (stack) only when scale > 1 */
}

body:is(.ui-hidden, .focus-mode) .image-view img:active {
    cursor: grabbing;
}

/* Zoom indicator hint */
body:is(.ui-hidden, .focus-mode)::after {
    content: 'Scroll to zoom • Drag to pan • ESC to exit';
    position: fixed;
    bottom: var(--spacing-lg);
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: var(--primary-blue);
    padding: var(--spacing-md) 24px;
    border-radius: var(--radius-md);
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-medium);
    z-index: calc(var(--z-modal) + 2);
    pointer-events: none;
    opacity: 0;
    animation: fadeInOut 4s ease-in-out;
}

/* Responsive */

/* Right sidebar content - constrain to viewport height, inner Similar panel scrolls */
.image-page .sidebar-right #sidebar-right-content {
    flex: 1 1 0;
    min-height: 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* FAISS Loading Indicator */
.faiss-loading-indicator {
    padding: var(--spacing-md);
    text-align: center;
    color: var(--text-muted);
}

.faiss-loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-sm);
}

.faiss-loading-spinner {
    width: 24px;
    height: 24px;
    border: 3px solid var(--border-color);
    border-top-color: var(--cyan-accent, #00d4ff);
    border-radius: 50%;
    animation: faiss-spin 0.8s linear infinite;
}

@keyframes faiss-spin {
    to {
        transform: rotate(360deg);
    }
}

.faiss-loading-text {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
}

/* ============================================
   Info Panel Redesign Styles
   ============================================ */

/* Info Sections */
.image-page .info-section {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 2px 0;
}

.image-page .info-section:first-child {
    padding-top: 0;
}

/* Space between Information header and first content (stat bubbles) */
.image-page .metadata-info .panel-collapsible-content>.info-section:first-child {
    padding-top: 8px;
}

.image-page .info-section+.info-section {
    margin-top: 0;
    padding-top: 2px;
    border-top: 1px solid rgba(99, 179, 237, 0.1);
}

/* Info Row - Horizontal Layout */
.image-page .info-row {
    display: grid;
    grid-template-columns: 60px 1fr;
    gap: 6px;
    align-items: start;
    font-size: 11px;
}

.image-page .info-label {
    color: var(--text-muted);
    font-size: 10px;
    padding-top: 1px;
}

.image-page .info-value {
    color: var(--text-secondary);
    line-height: 1.3;
    word-wrap: break-word;
    word-break: break-all;
    overflow-wrap: break-word;
}

/* Monospace values for hashes - single line with horizontal scroll to avoid single-char wrap */
.image-page .info-value.mono {
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
    font-size: 11px;
    background: rgba(0, 0, 0, 0.3);
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    border: 1px solid rgba(99, 179, 237, 0.15);
    user-select: all;
    white-space: nowrap;
    overflow-x: auto;
    max-width: 100%;
    min-width: 0;
    line-height: 1.5;
}

/* Source Links */
.image-page .source-links {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.image-page .source-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: var(--primary-blue);
    text-decoration: none;
    font-size: 13px;
    padding: 4px 8px;
    border-radius: var(--radius-sm);
    transition: all var(--transition-normal);
    background: rgba(99, 179, 237, 0.05);
}

.image-page .source-link:hover {
    background: rgba(99, 179, 237, 0.15);
    padding-left: 12px;
}

.image-page .source-link svg {
    width: 12px;
    height: 12px;
    flex-shrink: 0;
}

/* Quick Stats Grid */
.image-page .stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 4px;
}

.image-page .stat-item {
    display: flex;
    flex-direction: column;
    gap: 1px;
}

.image-page .stat-label {
    font-size: 8px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: var(--font-weight-medium);
}

.image-page .stat-value {
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: var(--font-weight-medium);
}

/* ============================================
   Bordered Stat Boxes (Design Refresh)
   ============================================ */
.image-page .stats-grid-bordered {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
}

.image-page .stat-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 10px 8px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    text-align: center;
    background: rgba(255, 255, 255, 0.02);
    transition: border-color var(--transition-normal);
}

.image-page .stat-box:hover {
    border-color: var(--border-color-hover);
}

.image-page .stat-box .stat-label {
    font-size: 9px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: var(--font-weight-medium);
    margin-bottom: 3px;
}

.image-page .stat-box .stat-value {
    font-size: 14px;
    color: var(--text-primary);
    font-weight: var(--font-weight-bold);
}

/* Rating value colors */
.image-page .rating-value.rating-general {
    color: var(--rating-general);
}

.image-page .rating-value.rating-sensitive {
    color: var(--rating-sensitive);
}

.image-page .rating-value.rating-questionable {
    color: var(--rating-questionable);
}

.image-page .rating-value.rating-explicit {
    color: var(--rating-explicit);
}

/* File Info Box */
.image-page .file-info-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 8px 6px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    text-align: center;
    background: rgba(255, 255, 255, 0.02);
}

.image-page .file-info-box .stat-label {
    font-size: 9px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: var(--font-weight-medium);
    margin-bottom: 2px;
}

.image-page .file-info-box .stat-value {
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: var(--font-weight-medium);
    word-break: break-all;
}

.image-page .file-info-box .file-size {
    display: inline-block;
    margin-left: 0.5em;
    color: var(--text-muted);
    font-size: 10px;
    font-weight: var(--font-weight-medium);
    white-space: nowrap;
}

/* ============================================
   Image Navigation Arrows
   ============================================ */
.image-page .image-view-wrapper {
    flex: 1 1 auto;
    display: flex;
    align-items: stretch;
    min-height: 0;
    position: relative;
}

.image-page .image-nav-btn {
    align-self: center;
    position: relative;
    z-index: var(--z-base);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    min-width: 28px;
    height: 56px;
    background: rgba(15, 15, 25, 0.5);
    border: 1px solid rgba(135, 206, 235, 0.1);
    border-radius: var(--radius-md);
    color: var(--text-muted);
    font-size: 12px;
    cursor: pointer;
    transition: all var(--transition-normal);
    flex-shrink: 0;
    opacity: 0;
}

.image-page .image-view-wrapper:hover .image-nav-btn {
    opacity: 1;
}

.image-page .image-nav-btn:hover {
    background: rgba(30, 30, 45, 0.85);
    border-color: var(--border-color-hover);
    color: var(--primary-blue);
}

.image-page .image-nav-prev {
    margin-right: 4px;
}

.image-page .image-nav-next {
    margin-left: 4px;
}

/* Utility Actions */
.image-page .utility-actions {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid rgba(99, 179, 237, 0.1);
}

.image-page .utility-link {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    font-size: 12px;
    color: var(--text-muted);
    text-decoration: none;
    border-radius: var(--radius-sm);
    transition: all var(--transition-normal);
    background: transparent;
    border: none;
    cursor: pointer;
    width: 100%;
    text-align: left;
}

.image-page .utility-link:hover {
    background: rgba(99, 179, 237, 0.08);
    color: var(--primary-blue);
    padding-left: 12px;
}

.image-page .utility-link.success {
    color: var(--success);
}

.image-page .utility-link.success:hover {
    background: rgba(34, 197, 94, 0.08);
}

.image-page .utility-icon {
    flex-shrink: 0;
}

.image-page .utility-text {
    flex: 1;
}