<div class="header-container">
    <div class="header">
        <div class="header-content">
            <h1><a href="{{ url_for('main.home') }}">HomeBooru</a></h1>
            <div class="search-bar">
                <form action="{{ url_for('main.home') }}" method="get" id="searchForm">
                    <div class="autocomplete-container">
                        <input type="text" name="query" id="searchInput" placeholder="Search tags..." value="{{ query or '' }}" autocomplete="off">
                        <div class="autocomplete-suggestions" id="autocompleteSuggestions"></div>
                    </div>
                    <button type="submit">Search</button>
                </form>
            </div>
            <button id="tabs-toggle-button" class="tabs-toggle-button">
                <span class="arrow"></span>
            </button>
        </div>
    </div>

    <div class="stats-tabs-bar">
        <button class="stat-tab-button" data-tab="overview-panel">
            <span class="icon">ğŸ“Š</span>
            <span>Overview</span>
        </button>

        {% if stats.source_breakdown %}
        <button class="stat-tab-button" data-tab="sources-panel">
            <span class="icon">ğŸŒ</span>
            <span>Sources</span>
        </button>
        {% endif %}

        {% if stats.top_tags %}
        <button class="stat-tab-button" data-tab="top-tags-panel">
            <span class="icon">ğŸ†</span>
            <span>Top Tags</span>
        </button>
        {% endif %}

        {% if stats.category_counts %}
        <button class="stat-tab-button" data-tab="categories-panel">
            <span class="icon">ğŸ·ï¸</span>
            <span>Categories</span>
        </button>
        {% endif %}

        {% if random_tags %}
        <button class="stat-tab-button" data-tab="explore-panel">
            <span class="icon">ğŸ²</span>
            <span>Explore</span>
        </button>
        {% endif %}

        <a href="{{ url_for('main.tags_browser') }}" class="stat-tab-button" style="text-decoration: none;">
            <span class="icon">ğŸ”–</span>
            <span>All Tags</span>
        </a>

        <button class="stat-tab-button" data-tab="system-panel">
            <span class="icon">âš™ï¸</span>
            <span>System</span>
        </button>
    </div>
    
    <div class="stats-panels-container" id="statsPanelsContainer">
        <div class="stat-panel panel" id="overview-panel">
            <h3><span>ğŸ“Š</span> Collection Overview</h3>
            <div class="stats-grid">
                <a href="{{ url_for('main.home') }}" style="text-decoration: none; color: inherit;">
                    <div class="stat-card">
                        <div class="stat-card-number">{{ stats.total }}</div>
                        <div class="stat-card-label">Total Images</div>
                    </div>
                </a>
                <a href="{{ url_for('main.home', query='metadata:found') }}" style="text-decoration: none; color: inherit;">
                    <div class="stat-card success">
                        <div class="stat-card-number">{{ stats.with_metadata }}</div>
                        <div class="stat-card-label">With Metadata</div>
                    </div>
                </a>
                <a href="{{ url_for('main.home', query='metadata:missing') }}" style="text-decoration: none; color: inherit;">
                    <div class="stat-card warning">
                        <div class="stat-card-number">{{ stats.without_metadata }}</div>
                        <div class="stat-card-label">Missing Metadata</div>
                    </div>
                </a>
                <div class="stat-card">
                    <div class="stat-card-number">{{ stats.total_tags }}</div>
                    <div class="stat-card-label">Unique Tags</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-number">{{ stats.avg_tags_per_image }}</div>
                    <div class="stat-card-label">Avg Tags/Image</div>
                </div>
            </div>
        </div>

        {% if stats.source_breakdown %}
        <div class="stat-panel panel" id="sources-panel">
            <h3><span>ğŸŒ</span> Source Distribution</h3>
            <div class="stats-grid">
                {% for source, count in stats.source_breakdown.items() %}
                <a href="{{ url_for('main.home', query='source:' + source) }}" style="text-decoration: none; color: inherit;">
                    <div class="stat-card">
                        <div class="stat-card-number">{{ count }}</div>
                        <div class="stat-card-label">{{ source|capitalize }}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if stats.top_tags %}
        <div class="stat-panel panel" id="top-tags-panel">
            <h3><span>ğŸ†</span> Most Popular Tags</h3>
            <div class="top-tags-list">
                {% for tag, count in stats.top_tags %}
                <a href="{{ url_for('main.home', query=tag) }}" class="tag-link">
                    <span class="tag-name">{{ tag }}</span>
                    <span class="tag-count">{{ count }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if stats.category_counts %}
        <div class="stat-panel panel" id="categories-panel">
            <h3><span>ğŸ·ï¸</span> Tag Categories</h3>
            <div class="category-breakdown">
                {% for category, count in stats.category_counts.items() %}
                <a href="{{ url_for('main.home', query='category:' + category) }}" style="text-decoration: none; color: inherit;">
                    <div class="category-card {{ category }}">
                        <div class="category-number">{{ count }}</div>
                        <div class="category-label">{{ category|capitalize }}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if random_tags %}
        <div class="stat-panel panel" id="explore-panel">
            <h3><span>ğŸ²</span> Random Tags</h3>
            <div class="top-tags-list">
                {% for tag, count in random_tags %}
                <a href="{{ url_for('main.home', query=tag) }}" class="tag-link">
                    <span class="tag-name">{{ tag }}</span>
                    <span class="tag-count">{{ count }}</span>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="stat-panel panel" id="system-panel">
            <h3><span>âš™ï¸</span> System Control</h3>

            <div id="secretSection"></div>

            <div class="system-status" id="systemStatus">
                <div class="status-loading">Loading status...</div>
            </div>

            <div class="system-actions" id="systemActionsSection">
                <h4>Actions</h4>
                <div class="system-buttons">
                    <button class="btn btn-primary" onclick="systemScanImages(event)">
                        ğŸ” Scan & Process New Images
                    </button>
                    <button class="btn btn-primary" onclick="systemRebuildTags(event)">
                        ğŸ”„ Re-process All Tags
                    </button>
                    <button class="btn btn-primary" onclick="systemRecategorizeTags(event)">
                        ğŸ·ï¸ Recategorize Tags
                    </button>
                    <button class="btn btn-secondary" onclick="systemRebuildCategorized(event)">
                        ğŸ› ï¸ Rebuild Categorized Tags
                    </button>
                    <button class="btn btn-primary" onclick="systemGenerateThumbnails(event)">
                        ğŸ–¼ï¸ Generate Thumbnails
                    </button>
                    <button class="btn btn-danger" onclick="systemDeduplicate(event)">
                        ğŸ—‘ï¸ Deduplicate Images
                    </button>
                    <button class="btn btn-danger" onclick="systemCleanOrphans(event)">
                        ğŸ§¹ Clean Orphan Metadata
                    </button>
                    <button class="btn btn-success" onclick="systemReloadData(event)">
                        â†» Reload Data
                    </button>
                </div>

                <h4>Monitor Control</h4>
                <div class="system-buttons">
                    <button id="monitorToggleBtn" class="btn btn-success">
                        â–¶ï¸ Start Monitor
                    </button>
                </div>

                <h4>Activity Log</h4>
                <div class="system-logs" id="systemLogs">
                    <div class="log-entry info">No recent activity</div>
                </div>
            </div>
        </div>
    </div>
</div>