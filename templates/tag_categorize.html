<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Categorize Tags - {{ app_name }}</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components-bundle.css') + '?v=1' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/page-layout.css') + '?v=1' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tag-categorization.css') + '?v=3' }}">
</head>
<body>
    {% include 'header.html' %}

    <div class="page-container page-container-full">
        <!-- Page Header -->
        <div class="page-header tag-categorize-header">
            <div class="page-header-left">
                <h1 class="page-title">
                    <span class="page-title-icon">üè∑Ô∏è</span>
                    Categorize Tags
                </h1>
            </div>
            <div class="page-header-stats" id="statsSummary">
                <div class="page-header-stat">
                    <span class="page-header-stat-value" id="statTotal">0</span>
                    <span>total</span>
                </div>
                <div class="page-header-stat">
                    <span class="page-header-stat-value" id="statCategorized">0</span>
                    <span>categorized</span>
                </div>
                <div class="page-header-stat">
                    <span class="page-header-stat-value" id="statUncategorized">0</span>
                    <span>uncategorized</span>
                </div>
            </div>
            <div class="page-header-right">
                <button class="action-btn action-btn-primary" onclick="exportCategorizations()">
                    Export
                </button>
                <button class="action-btn action-btn-secondary" onclick="document.getElementById('importFileInput').click()">
                    Import
                </button>
                <input type="file" id="importFileInput" accept=".json" style="display: none;" onchange="handleImportFile(event)">
                <button class="action-btn action-btn-success" onclick="syncBaseCategories()"
                    title="Update base categories (general/meta) based on their extended categories. Character, artist, copyright, and species tags are not affected.">
                    Sync Base Categories
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar-container progress-bar-container-centered">
            <div class="progress-bar-fill" id="categorizeProgress" style="width: 0%;"></div>
        </div>

        <!-- Three-panel layout -->
        <div class="panel-layout panel-layout-padded">
            <!-- Left Panel - Category Guide -->
            <aside class="panel panel-left">
                <div class="panel-header">
                    <h3 class="panel-title">Category Guide</h3>
                </div>

                <div class="panel-section">
                    <h4 class="panel-section-title">Group 1: Identity</h4>
                    <div class="list-container list-container-unlimited">
                        <div class="list-item"><span class="list-item-name">Subject_Count</span><span class="list-item-meta">Count & gender</span></div>
                        <div class="list-item"><span class="list-item-name">Body_Physique</span><span class="list-item-meta">Permanent body traits</span></div>
                        <div class="list-item"><span class="list-item-name">Body_Hair</span><span class="list-item-meta">Head hair only</span></div>
                        <div class="list-item"><span class="list-item-name">Body_Face</span><span class="list-item-meta">Eyes & face marks</span></div>
                        <div class="list-item"><span class="list-item-name">Body_Genitalia</span><span class="list-item-meta">NSFW anatomy</span></div>
                    </div>
                </div>

                <div class="panel-section">
                    <h4 class="panel-section-title">Group 2: Context</h4>
                    <div class="list-container list-container-unlimited">
                        <div class="list-item"><span class="list-item-name">Attire_Main</span><span class="list-item-meta">Main clothing</span></div>
                        <div class="list-item"><span class="list-item-name">Attire_Inner</span><span class="list-item-meta">Underwear/swimwear</span></div>
                        <div class="list-item"><span class="list-item-name">Attire_Legwear</span><span class="list-item-meta">Socks & hosiery</span></div>
                        <div class="list-item"><span class="list-item-name">Attire_Acc</span><span class="list-item-meta">Accessories</span></div>
                        <div class="list-item"><span class="list-item-name">Status</span><span class="list-item-meta">State of being</span></div>
                        <div class="list-item"><span class="list-item-name">Action</span><span class="list-item-meta">Active verbs</span></div>
                        <div class="list-item"><span class="list-item-name">Pose</span><span class="list-item-meta">Body position</span></div>
                        <div class="list-item"><span class="list-item-name">Expression</span><span class="list-item-meta">Emotion</span></div>
                        <div class="list-item"><span class="list-item-name">Sexual_Act</span><span class="list-item-meta">NSFW interaction</span></div>
                        <div class="list-item"><span class="list-item-name">Object</span><span class="list-item-meta">Props</span></div>
                        <div class="list-item"><span class="list-item-name">Setting</span><span class="list-item-meta">Location</span></div>
                    </div>
                </div>

                <div class="panel-section">
                    <h4 class="panel-section-title">Group 3: Technical/Meta</h4>
                    <div class="list-container list-container-unlimited">
                        <div class="list-item"><span class="list-item-name">Framing</span><span class="list-item-meta">Camera angle</span></div>
                        <div class="list-item"><span class="list-item-name">Focus</span><span class="list-item-meta">Part focus</span></div>
                        <div class="list-item"><span class="list-item-name">Style_Art</span><span class="list-item-meta">Art style</span></div>
                        <div class="list-item"><span class="list-item-name">Style_Tech</span><span class="list-item-meta">Visual effects</span></div>
                        <div class="list-item"><span class="list-item-name">Meta_Attributes</span><span class="list-item-meta">Metadata</span></div>
                        <div class="list-item"><span class="list-item-name">Meta_Text</span><span class="list-item-meta">Text & UI</span></div>
                    </div>
                </div>
            </aside>

            <!-- Center Panel - Tag Display -->
            <main class="panel panel-center">
                <div class="tag-display" id="tagDisplay">
                    <div class="empty-state" id="loadingState">
                        <div class="empty-state-icon">‚è≥</div>
                        <div class="empty-state-text">Loading tags...</div>
                    </div>
                </div>
            </main>

            <!-- Right Panel - Edit & Queue -->
            <aside class="panel panel-right">
                <div class="panel-section">
                    <h3 class="panel-section-title">Edit Tag</h3>
                    <div class="filter-group">
                        <input type="text" id="editTagInput" class="filter-input" placeholder="Tag name...">
                        <button onclick="loadTagForEdit()" class="action-btn action-btn-primary action-btn-full-width action-btn-spaced">Load</button>
                    </div>
                    <div id="editTagDisplay" class="edit-tag-display"></div>
                </div>

                <div class="panel-section">
                    <h3 class="panel-section-title">Next Tags</h3>
                    <div class="list-container" id="queueList">
                        <div class="empty-state">
                            <div class="empty-state-icon">‚è≥</div>
                            <div class="empty-state-text">Loading...</div>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <!-- Page Footer -->
    <div class="page-footer">
        <div class="page-footer-left">
            <span class="page-footer-item" id="footerStatus">Ready</span>
        </div>
        <div class="page-footer-shortcuts">
            <span class="shortcut"><span class="shortcut-key">1-9</span> Quick Category</span>
            <span class="shortcut"><span class="shortcut-key">S</span> Skip</span>
            <span class="shortcut"><span class="shortcut-key">Z</span> Undo</span>
            <span class="shortcut"><span class="shortcut-key">Esc</span> Close</span>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeExportModal()">&times;</span>
            <h3>Export Tag Categorizations</h3>
            <p>Choose which tags to export:</p>
            <div class="filter-radio-group filter-radio-group-spaced">
                <label class="filter-radio-label">
                    <input type="radio" name="exportType" value="categorized" checked>
                    <span><strong>Categorized Tags Only</strong> - Export only tags that have been categorized</span>
                </label>
                <label class="filter-radio-label">
                    <input type="radio" name="exportType" value="all">
                    <span><strong>All Tags</strong> - Export all tags (including uncategorized)</span>
                </label>
            </div>
            <div class="page-actions">
                <button class="action-btn action-btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button class="action-btn action-btn-primary" onclick="confirmExport()">Export</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeImportModal()">&times;</span>
            <h3>Import Tag Categorizations</h3>
            <p>Choose how to import the categorizations:</p>
            <div class="filter-radio-group filter-radio-group-spaced">
                <label class="filter-radio-label">
                    <input type="radio" name="importMode" value="merge" checked>
                    <span><strong>Merge (Recommended)</strong> - Keep existing categorizations, only categorize uncategorized tags</span>
                </label>
                <label class="filter-radio-label">
                    <input type="radio" name="importMode" value="update">
                    <span><strong>Update</strong> - Only update already categorized tags, leave uncategorized tags as-is</span>
                </label>
                <label class="filter-radio-label filter-radio-label-danger">
                    <input type="radio" name="importMode" value="overwrite">
                    <span><strong>Overwrite (Dangerous)</strong> - Replace ALL categorizations - this will overwrite existing work!</span>
                </label>
            </div>
            <div class="page-actions">
                <button class="action-btn action-btn-secondary" onclick="closeImportModal()">Cancel</button>
                <button class="action-btn action-btn-primary" onclick="confirmImport()">Import</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/autocomplete.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/pages/tag-categorize.js') + '?v=2' }}"></script>
    <script type="module">
        import { showNotification } from "{{ url_for('static', filename='js/utils/notifications.js') }}";
        window.showNotification = showNotification;
    </script>
</body>
</html>
