<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Categorize Tags - {{ app_name }}</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tag-categorization.css') + '?v=2' }}">
</head>

<body>
    {% include 'header.html' %}

    <div class="categorize-container">
        <div class="categorize-header">
            <div class="categorize-title">Categorize Tags</div>
            <div class="categorize-progress" id="categorizeProgress">Loading...</div>
        </div>

        <div class="stats-summary" id="statsSummary" style="display: none;">
            <div class="stat-box">
                <div class="stat-label">Total Tags</div>
                <div class="stat-value" id="statTotal">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Categorized</div>
                <div class="stat-value" id="statCategorized">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">Uncategorized</div>
                <div class="stat-value" id="statUncategorized">0</div>
            </div>
        </div>

        <div class="categorize-layout">
            <div class="left-sidebar">
                <div class="categorization-guide">
                    <div class="guide-header">Category Guide</div>
                    <div class="guide-content">
                        <div class="guide-section">
                            <h3>Group 1: Identity</h3>
                            <ul>
                                <li><strong>Subject_Count:</strong> Count & gender</li>
                                <li><strong>Body_Physique:</strong> Permanent body traits</li>
                                <li><strong>Body_Hair:</strong> Head hair only</li>
                                <li><strong>Body_Face:</strong> Eyes & face marks</li>
                                <li><strong>Body_Genitalia:</strong> NSFW anatomy</li>
                            </ul>
                        </div>

                        <div class="guide-section">
                            <h3>Group 2: Context</h3>
                            <ul>
                                <li><strong>Attire_Main:</strong> Main clothing</li>
                                <li><strong>Attire_Inner:</strong> Underwear/swimwear</li>
                                <li><strong>Attire_Legwear:</strong> Socks & hosiery</li>
                                <li><strong>Attire_Acc:</strong> Accessories</li>
                                <li><strong>Status:</strong> State of being</li>
                                <li><strong>Action:</strong> Active verbs</li>
                                <li><strong>Pose:</strong> Body position</li>
                                <li><strong>Expression:</strong> Emotion</li>
                                <li><strong>Sexual_Act:</strong> NSFW interaction</li>
                                <li><strong>Object:</strong> Props</li>
                                <li><strong>Setting:</strong> Location</li>
                            </ul>
                        </div>

                        <div class="guide-section">
                            <h3>Group 3: Technical/Meta</h3>
                            <ul>
                                <li><strong>Framing:</strong> Camera angle</li>
                                <li><strong>Focus:</strong> Part focus</li>
                                <li><strong>Style_Art:</strong> Art style</li>
                                <li><strong>Style_Tech:</strong> Visual effects</li>
                                <li><strong>Meta_Attributes:</strong> Metadata</li>
                                <li><strong>Meta_Text:</strong> Text & UI</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tag-display" id="tagDisplay">
                <div class="loading-state" id="loadingState">
                    Loading tags...
                </div>
            </div>

            <div class="right-sidebar">
                <div class="import-export-section">
                    <div class="import-export-header">Import/Export</div>
                    <div class="import-export-buttons">
                        <button class="import-export-btn export-btn" onclick="exportCategorizations()">
                            <span class="btn-icon">â¬‡</span> Export
                        </button>
                        <button class="import-export-btn import-btn"
                            onclick="document.getElementById('importFileInput').click()">
                            <span class="btn-icon">â¬†</span> Import
                        </button>
                        <input type="file" id="importFileInput" accept=".json" style="display: none;"
                            onchange="handleImportFile(event)">
                    </div>
                    <div class="import-export-header" style="margin-top: 20px;">Maintenance</div>
                    <div class="import-export-buttons">
                        <button class="import-export-btn" onclick="syncBaseCategories()"
                            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <span class="btn-icon">ðŸ”„</span> Sync Base Categories
                        </button>
                    </div>
                </div>

                <div class="edit-tag-section">
                    <div class="edit-tag-header">Edit Tag</div>
                    <div class="edit-tag-controls">
                        <input type="text" id="editTagInput" placeholder="Tag name..." class="edit-tag-input">
                        <button onclick="loadTagForEdit()" class="edit-tag-btn">Load</button>
                    </div>
                    <div id="editTagDisplay" class="edit-tag-display"></div>
                </div>

                <div class="tag-queue-sidebar">
                    <div class="queue-header">Next Tags</div>
                    <div class="queue-list" id="queueList">
                        <div class="queue-loading">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="custom-modal" style="display: none;">
        <div class="custom-modal-overlay" onclick="closeExportModal()"></div>
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h2>Export Tag Categorizations</h2>
                <button class="custom-modal-close" onclick="closeExportModal()">Ã—</button>
            </div>
            <div class="custom-modal-body">
                <p>Choose which tags to export:</p>
                <div class="export-options">
                    <label class="export-option">
                        <input type="radio" name="exportType" value="categorized" checked>
                        <div class="option-content">
                            <strong>Categorized Tags Only</strong>
                            <span>Export only tags that have been categorized</span>
                        </div>
                    </label>
                    <label class="export-option">
                        <input type="radio" name="exportType" value="all">
                        <div class="option-content">
                            <strong>All Tags</strong>
                            <span>Export all tags (including uncategorized)</span>
                        </div>
                    </label>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeExportModal()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmExport()">Export</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="custom-modal" style="display: none;">
        <div class="custom-modal-overlay" onclick="closeImportModal()"></div>
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <h2>Import Tag Categorizations</h2>
                <button class="custom-modal-close" onclick="closeImportModal()">Ã—</button>
            </div>
            <div class="custom-modal-body">
                <p>Choose how to import the categorizations:</p>
                <div class="import-options">
                    <label class="import-option">
                        <input type="radio" name="importMode" value="merge" checked>
                        <div class="option-content">
                            <strong>Merge (Recommended)</strong>
                            <span>Keep existing categorizations, only categorize uncategorized tags</span>
                        </div>
                    </label>
                    <label class="import-option">
                        <input type="radio" name="importMode" value="update">
                        <div class="option-content">
                            <strong>Update</strong>
                            <span>Only update already categorized tags, leave uncategorized tags as-is</span>
                        </div>
                    </label>
                    <label class="import-option import-option-danger">
                        <input type="radio" name="importMode" value="overwrite">
                        <div class="option-content">
                            <strong>Overwrite (Dangerous)</strong>
                            <span>Replace ALL categorizations - this will overwrite existing work!</span>
                        </div>
                    </label>
                </div>
            </div>
            <div class="custom-modal-footer">
                <button class="modal-btn modal-btn-secondary" onclick="closeImportModal()">Cancel</button>
                <button class="modal-btn modal-btn-primary" onclick="confirmImport()">Import</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/autocomplete.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/system-panel.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/pages/tag-categorize.js') }}"></script>
    <script type="module">
        import { showNotification } from "{{ url_for('static', filename='js/utils/notifications.js') }}";
        window.showNotification = showNotification;
    </script>
</body>

</html>