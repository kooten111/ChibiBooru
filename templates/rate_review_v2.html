<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Rate Images - {{ app_name }}</title>
    <link rel="icon" href="{{ url_for('static', filename='favicon.svg') }}" type="image/svg+xml">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/variables.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') + '?v=2' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components-bundle.css') + '?v=1' }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/rating-modern.css') + '?v=1' }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap"
        rel="stylesheet">
</head>

<body class="rate-container-v2">
    {% include 'header.html' %}

    <!-- Header Bar -->
    <div class="rate-header-v2">
        <h1>
            <span>‚ú®</span>
            Rate Images
        </h1>

        <!-- Progress Indicator -->
        <div style="margin-top: 1rem; display: flex; align-items: center; gap: 2rem;">
            <div id="progressText" style="font-size: 1.1em; color: var(--cyan-accent);">
                Loading...
            </div>
            <div
                style="flex: 1; max-width: 400px; background: rgba(255,255,255,0.05); height: 8px; border-radius: 1rem; overflow: hidden;">
                <div id="progressBar"
                    style="height: 100%; background: var(--cyan-accent); width: 0%; transition: width 0.3s ease; border-radius: 1rem;">
                </div>
            </div>
        </div>

        <!-- Filter Pills -->
        <div style="margin-top: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="radio" name="filter" value="unrated" checked id="filterUnrated" onchange="changeFilter()"
                    style="accent-color: var(--cyan-accent);">
                <span>‚ùì Unrated</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="radio" name="filter" value="ai_predicted" id="filterAI" onchange="changeFilter()"
                    style="accent-color: var(--cyan-accent);">
                <span>ü§ñ AI-Predicted</span>
            </label>
            <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="radio" name="filter" value="all" id="filterAll" onchange="changeFilter()"
                    style="accent-color: var(--cyan-accent);">
                <span>üìã All Images</span>
            </label>
            <button class="btn-v2" onclick="shuffleImages()" style="margin-left: auto;">
                <span>üîÄ</span>
                Shuffle
            </button>
        </div>
    </div>

    <!-- Main Image Display -->
    <div style="margin: 2rem; position: relative;">
        <!-- AI Suggestion Badge (hidden by default) - Outside imageDisplay to persist -->
        <div class="ai-suggestion" id="aiSuggestion" style="display: none; margin-bottom: 1rem;">
            <span>ü§ñ</span>
            <span id="aiSuggestionText">AI suggests: General</span>
        </div>

        <!-- Confidence Bar (hidden by default) - Outside imageDisplay to persist -->
        <div class="confidence-bar" id="confidenceBar" style="display: none; margin-bottom: 1rem;">
            <div class="label">
                Confidence: <span id="confidenceValue">0%</span>
            </div>
            <div class="bar">
                <div class="fill" id="confidenceFill" style="width: 0%;"></div>
            </div>
        </div>

        <!-- Image container - this gets replaced by JS -->
        <div class="image-display-v2" id="imageDisplay">
            <div id="loadingState" style="padding: 4rem; color: var(--text-muted);">
                Loading images...
            </div>
        </div>
    </div>

    <!-- Rating Controls -->
    <div style="max-width: 1200px; margin: 0 auto; padding: 0 2rem;">
        <div class="rating-buttons-v2">
            <button class="rating-btn-v2 general" onclick="setRating('rating:general', 1)">
                General
                <span class="shortcut">Press <kbd class="kbd-v2">1</kbd></span>
            </button>
            <button class="rating-btn-v2 sensitive" onclick="setRating('rating:sensitive', 2)">
                Sensitive
                <span class="shortcut">Press <kbd class="kbd-v2">2</kbd></span>
            </button>
            <button class="rating-btn-v2 questionable" onclick="setRating('rating:questionable', 3)">
                Questionable
                <span class="shortcut">Press <kbd class="kbd-v2">3</kbd></span>
            </button>
            <button class="rating-btn-v2 explicit" onclick="setRating('rating:explicit', 4)">
                Explicit
                <span class="shortcut">Press <kbd class="kbd-v2">4</kbd></span>
            </button>
        </div>

        <!-- Navigation -->
        <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 2rem;">
            <button class="btn-v2" onclick="previousImage()">
                <span>‚Üê</span>
                Previous
                <span class="shortcut" style="margin-left: 0.5rem;"><kbd class="kbd-v2">P</kbd></span>
            </button>
            <button class="btn-v2 warning" onclick="skipImage()">
                <span>‚è≠Ô∏è</span>
                Skip
                <span class="shortcut" style="margin-left: 0.5rem;"><kbd class="kbd-v2">S</kbd></span>
            </button>
            <button class="btn-v2" onclick="nextImage()">
                Next
                <span>‚Üí</span>
                <span class="shortcut" style="margin-left: 0.5rem;"><kbd class="kbd-v2">N</kbd></span>
            </button>
        </div>

        <!-- Image Tags (Collapsible) -->
        <div
            style="margin-top: 3rem; background: var(--modern-panel); backdrop-filter: var(--blur-md); border: 1px solid var(--cyan-border); border-radius: 1rem; padding: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;"
                onclick="toggleTags()">
                <h3 style="color: var(--cyan-accent); margin: 0;">
                    Image Tags
                    <span id="tagCount" style="font-size: 0.8em; color: var(--text-muted); margin-left: 0.5rem;">(0
                        tags)</span>
                </h3>
                <span id="tagsToggleIcon" style="font-size: 1.5em; transition: transform 0.3s ease;">‚ñº</span>
            </div>
            <div id="imageTags" style="margin-top: 1rem; display: none;">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Footer Status Bar -->
    <div class="footer-status-v2" style="margin-top: 4rem;">
        <div class="left">
            <span id="footerStatus">Ready</span>
        </div>
        <div class="right">
            <span>Keyboard Shortcuts:</span>
            <span><kbd class="kbd-v2">1-4</kbd> Rate</span>
            <span><kbd class="kbd-v2">‚Üê ‚Üí</kbd> Navigate</span>
            <span><kbd class="kbd-v2">S</kbd> Skip</span>
            <span><kbd class="kbd-v2">T</kbd> Toggle Tags</span>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/modal.js') }}"></script>
    <script src="{{ url_for('static', filename='js/header.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/pages/rate-review-v2.js') }}"></script>
    <script type="module">
        import { showNotification } from "{{ url_for('static', filename='js/utils/notifications.js') }}";
        window.showNotification = showNotification;
    </script>
</body>

</html>